{% extends "base.html" %}

{% block title %}Sentinel | Dashboard Overview{% endblock %}

{% block content %}
<!-- Page Header & Filters -->
<div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-8">
    <div>
        <h1 class="text-3xl font-black text-theme-text tracking-tight mb-2">Dashboard</h1>
        <p class="text-theme-muted text-sm font-medium">Real-time fraud detection insights and analytics</p>
    </div>
    <div class="flex items-center gap-4">
        <div
            class="bg-theme-card border border-theme-border rounded-xl px-4 py-2 flex items-center gap-3 transition-colors duration-300">
            <span class="text-[10px] font-bold text-theme-muted uppercase tracking-widest">Category</span>
            <select
                class="bg-transparent border-none text-sm font-semibold text-theme-text focus:ring-0 outline-none w-32 cursor-pointer appearance-none">
                <option value="all">All Categories</option>
            </select>
        </div>
        <div
            class="bg-theme-card border border-theme-border rounded-xl px-4 py-2 flex items-center gap-3 transition-colors duration-300">
            <span class="text-[10px] font-bold text-theme-muted uppercase tracking-widest">Date Range</span>
            <div class="text-sm font-semibold text-theme-text flex items-center gap-2">
                <span>2025-07-18</span> <i data-lucide="arrow-right" class="h-3 w-3 text-theme-muted"></i>
                <span>2025-08-18</span>
            </div>
            <i data-lucide="calendar" class="h-4 w-4 text-theme-muted ml-2"></i>
        </div>
    </div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <!-- Card 1: Total Alerts -->
    <div
        class="bg-theme-card p-6 rounded-2xl shadow-xl border border-theme-border relative overflow-hidden group hover:border-blue-500/30 transition-all duration-300">
        <div class="flex items-start justify-between mb-4">
            <h3 class="text-theme-muted text-xs font-bold uppercase tracking-wider">Total Alerts</h3>
            <div
                class="bg-blue-500/10 p-2 rounded-lg text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform">
                <i data-lucide="bell" class="h-4 w-4"></i>
            </div>
        </div>
        <div class="flex items-baseline gap-2">
            <span class="text-3xl font-black text-theme-text">{{ stats.total_alerts }}</span>
        </div>
        <div
            class="mt-4 flex items-center gap-1.5 text-emerald-600 dark:text-emerald-400 text-[10px] font-bold tracking-wide bg-emerald-500/10 w-fit px-2 py-1 rounded-md">
            <i data-lucide="trending-up" class="h-3 w-3"></i>
            <span>12% dari kemarin</span>
        </div>
    </div>

    <!-- Card 2: Active Rules -->
    <div
        class="bg-theme-card p-6 rounded-2xl shadow-xl border border-theme-border relative overflow-hidden group hover:border-indigo-500/30 transition-all duration-300">
        <div class="flex items-start justify-between mb-4">
            <h3 class="text-theme-muted text-xs font-bold uppercase tracking-wider">Active Rules</h3>
            <div
                class="bg-indigo-500/10 p-2 rounded-lg text-indigo-600 dark:text-indigo-400 group-hover:scale-110 transition-transform">
                <i data-lucide="brain-circuit" class="h-4 w-4"></i>
            </div>
        </div>
        <div class="flex items-baseline gap-2">
            <span class="text-3xl font-black text-theme-text">{{ stats.active_rules }}</span>
        </div>
        <div
            class="mt-4 flex items-center gap-1.5 text-indigo-600 dark:text-indigo-400 text-[10px] font-bold tracking-wide bg-indigo-500/10 w-fit px-2 py-1 rounded-md">
            <i data-lucide="activity" class="h-3 w-3"></i>
            <span>8 aktif, 4 non-aktif</span>
        </div>
    </div>

    <!-- Card 3: High Risk -->
    <div
        class="bg-theme-card p-6 rounded-2xl shadow-xl border border-theme-border relative overflow-hidden group hover:border-rose-500/30 transition-all duration-300">
        <div class="flex items-start justify-between mb-4">
            <h3 class="text-theme-muted text-xs font-bold uppercase tracking-wider">High Risk</h3>
            <div
                class="bg-rose-500/10 p-2 rounded-lg text-rose-600 dark:text-rose-400 group-hover:scale-110 transition-transform">
                <i data-lucide="shield-alert" class="h-4 w-4"></i>
            </div>
        </div>
        <div class="flex items-baseline gap-2">
            <span class="text-3xl font-black text-rose-500">{{ stats.high_risk }}</span>
        </div>
        <div
            class="mt-4 flex items-center gap-1.5 text-rose-600 dark:text-rose-400 text-[10px] font-bold tracking-wide bg-rose-500/10 w-fit px-2 py-1 rounded-md">
            <i data-lucide="alert-triangle" class="h-3 w-3"></i>
            <span>Perlu perhatian</span>
        </div>
    </div>

    <!-- Card 4: Resolution Rate -->
    <div
        class="bg-theme-card p-6 rounded-2xl shadow-xl border border-theme-border relative overflow-hidden group hover:border-emerald-500/30 transition-all duration-300">
        <div class="flex items-start justify-between mb-4">
            <h3 class="text-theme-muted text-xs font-bold uppercase tracking-wider">Resolution Rate</h3>
            <div
                class="bg-emerald-500/10 p-2 rounded-lg text-emerald-600 dark:text-emerald-400 group-hover:scale-110 transition-transform">
                <i data-lucide="check-circle-2" class="h-4 w-4"></i>
            </div>
        </div>
        <div class="flex items-baseline gap-2">
            <span class="text-3xl font-black text-theme-text">{{ stats.resolution_rate }}</span>
        </div>
        <div class="mt-4 w-full bg-theme-input rounded-full h-1.5 mb-1.5 text-right transition-colors duration-300">
            <div class="bg-emerald-500 h-1.5 rounded-full" style="width: 76%"></div>
        </div>
        <p class="text-[9px] text-theme-muted font-bold">42/55 alert selesai</p>
    </div>
</div>

<!-- Category Bar Chart -->
<div
    class="bg-theme-card border border-theme-border rounded-3xl shadow-xl p-8 mb-10 w-full transition-colors duration-300">
    <h3 class="text-lg font-black text-theme-text mb-8 tracking-tight">Total Alerts per Category</h3>

    <div class="space-y-5">
        {% for cat in alerts_by_category %}
        <div class="flex items-center group">
            <div class="w-1/3 text-xs font-semibold text-theme-muted pr-4 truncate" title="{{ cat.name }}">
                {{ cat.name }}
            </div>
            <div class="w-2/3 flex items-center">
                <!-- assuming max 40 for max-width calculation -->
                <div class="h-9 bg-gradient-to-r from-blue-600 to-blue-500 rounded-r-md rounded-l-sm transition-all duration-1000 ease-out group-hover:brightness-110 shadow-[0_4px_15px_rgba(59,130,246,0.2)] flex items-center justify-end px-4 text-white text-xs font-bold relative"
                    style="width: {{ (cat.count / 40) * 100 }}%; min-width: 40px;">
                    {{ cat.count }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Alerts Table -->
<div class="bg-theme-card border border-theme-border rounded-3xl shadow-xl p-8 mb-10 transition-colors duration-300">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-lg font-black text-theme-text tracking-tight">10 Latest Alerts</h3>
        <button
            class="text-xs font-bold text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 transition-colors bg-blue-500/10 px-4 py-2 rounded-lg">View
            All</button>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse whitespace-nowrap">
            <thead>
                <tr class="border-b border-theme-border">
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest">Alert ID
                    </th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest">Timestamp
                    </th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest">Cust/Acc ID
                    </th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest">Category
                    </th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest text-center">
                        # Trx</th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest">Total Amount
                    </th>
                    <th
                        class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest text-center w-40">
                        Risk Score (%)</th>
                    <th class="py-4 px-4 text-[10px] font-black text-theme-muted uppercase tracking-widest text-right">
                        Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-theme-border text-sm">
                {% for alert in latest_alerts %}
                <tr class="hover:bg-theme-hover transition-colors">
                    <td class="py-4 px-4">
                        <span
                            class="bg-theme-input px-2.5 py-1.5 rounded-md text-theme-text font-mono text-[11px] border border-theme-border shadow-sm">{{
                            alert.id }}</span>
                    </td>
                    <td class="py-4 px-4 text-theme-muted text-xs">{{ alert.time }}</td>
                    <td class="py-4 px-4 font-bold text-theme-text text-xs">{{ alert.acc }}
                        <div class="text-[9px] text-theme-muted mt-0.5">NACC-{{ alert.acc }}</div>
                    </td>
                    <td class="py-4 px-4">
                        <span
                            class="inline-flex items-center px-2 py-1.5 rounded text-[10px] font-bold tracking-wide {% if 'Anomaly' in alert.cat %}bg-blue-500/10 text-blue-600 border-blue-500/20 dark:bg-blue-500/20 dark:text-blue-400{% else %}bg-amber-500/10 text-amber-600 border-amber-500/20 dark:bg-amber-500/20 dark:text-amber-400{% endif %}">
                            {{ alert.cat }}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-theme-muted font-mono text-center text-xs">{{ alert.trx }}</td>
                    <td class="py-4 px-4 text-theme-text font-mono text-xs">{{ alert.amt }}</td>
                    <td class="py-4 px-4 w-40">
                        <div class="flex items-center gap-3">
                            <span
                                class="text-xs font-bold {% if alert.risk > 100 %}text-rose-500{% elif alert.risk > 50 %}text-amber-500{% else %}text-emerald-500{% endif %} w-10 text-right">{{
                                alert.risk }}%</span>
                            <div class="flex-1 bg-theme-input rounded-full h-1.5 overflow-hidden transition-colors">
                                <div class="{% if alert.risk > 100 %}bg-rose-500{% elif alert.risk > 50 %}bg-amber-500{% else %}bg-emerald-500{% endif %} h-1.5 rounded-full"
                                    style="width: {{ [alert.risk, 100]|min }}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-4 text-right">
                        <button
                            class="text-xs font-bold text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 transition-colors inline-flex items-center gap-1.5 bg-blue-500/10 hover:bg-theme-hover px-3 py-1.5 rounded-lg border border-transparent">
                            <i data-lucide="eye" class="h-3 w-3"></i> View
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // Script placeholder if any websocket interactivity is needed for the dashboard later
</script>
{% endblock %}